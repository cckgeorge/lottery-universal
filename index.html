<!doctype html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>æŠ½ç±¤å™¨</title>
<style>
  body{margin:0;font:18px/1.6 system-ui; background:#0b1020; color:#e8eeff}
  header{padding:20px;text-align:center}
  header h1{margin:0;font-size:26px}
  main{max-width:1000px;margin:0 auto;padding:16px}
  .card{background:#101630;border-radius:12px;padding:16px;margin-bottom:16px}
  select,input,button,textarea{padding:8px 12px;border-radius:8px;border:1px solid #555;background:#0d1430;color:#e8eeff}
  button{cursor:pointer}
  button.primary{background:#6ea8ff;border:none;color:#081532;font-weight:bold}
  .grid{display:grid;gap:12px;grid-template-columns:repeat(auto-fit,minmax(250px,1fr))}
  .classBox{background:#0d1430;border:1px solid #333;border-radius:10px;padding:20px;text-align:center;min-height:100px;display:flex;flex-direction:column;justify-content:center;font-size:26px;transition:all .3s ease}
  .highlight{animation:winFlash 1s ease forwards}
  @keyframes winFlash{0%{transform:scale(1);color:#fff;text-shadow:none}40%{transform:scale(1.4);color:#ffd166;text-shadow:0 0 8px #ffd166,0 0 16px #fffbcc}70%{transform:scale(1.2);color:#fff;text-shadow:0 0 6px #6ea8ff,0 0 12px #6ea8ff}100%{transform:scale(1);color:#fff;text-shadow:none}}
  table{width:100%;border-collapse:collapse;margin-top:12px}
  th,td{padding:6px 8px;border-bottom:1px solid #444;text-align:left}
  .btn-small{font-size:0.9em;padding:4px 8px;border-radius:6px;margin-left:4px;cursor:pointer}
</style>
</head>
<body>
<header>
  <h1>ğŸ¯ æŠ½ç±¤å™¨</h1>
</header>
<main>
  <section class="card">
    <h2>â‘  åå–®èˆ‡è¨­å®š</h2>
    <div style="margin:10px 0">
      <label>é¸æ“‡å¹´ç´šï¼š</label>
      <select id="gradeSelect">
        <option value="ä¸€å¹´">ä¸€å¹´ç´š</option>
        <option value="äºŒå¹´">äºŒå¹´ç´š</option>
        <option value="ä¸‰å¹´" selected>ä¸‰å¹´ç´š</option>
        <option value="å››å¹´">å››å¹´ç´š</option>
        <option value="äº”å¹´">äº”å¹´ç´š</option>
        <option value="å…­å¹´">å…­å¹´ç´š</option>
      </select>
    </div>
    <button class="primary" id="btnParse">é‡æ–°åŒ¯å…¥åå–®</button>
    <textarea id="roster" style="width:100%;min-height:140px;margin-top:8px"></textarea>
    <button id="btnDraw">é–‹å§‹æŠ½ç±¤</button>
  </section>

  <section class="card">
    <h2>â‘¡ æŠ½ç±¤å‹•ç•«ï¼ˆæ¯ç­ä¾åºåœä¸‹ï¼‰</h2>
    <div id="animationArea" class="grid"></div>
    <div id="finalResult"></div>
  </section>
</main>

<script>
// --- éŸ³æ•ˆ ---
let audioCtx=null;
function ensureAudio(){ if(!audioCtx) audioCtx=new(window.AudioContext||window.webkitAudioContext)(); }
function playTick(){ ensureAudio(); const ctx=audioCtx; const o=ctx.createOscillator(), g=ctx.createGain(); o.type='sine'; o.frequency.value=620; g.gain.value=0.04; o.connect(g); g.connect(ctx.destination); o.start(); o.stop(ctx.currentTime+0.04); }
function playDing(){ ensureAudio(); const ctx=audioCtx; const o=ctx.createOscillator(), g=ctx.createGain(); o.type='triangle'; o.frequency.value=880; o.connect(g); g.connect(ctx.destination); g.gain.setValueAtTime(0.18,ctx.currentTime); g.gain.exponentialRampToValueAtTime(0.001,ctx.currentTime+0.9); o.start(); o.stop(ctx.currentTime+0.9); }

// --- å…§å»ºåå–®ï¼ˆä¸‰ï½å…­å¹´ç´šï¼‰ï¼Œä¸€å¹´ç´šèˆ‡äºŒå¹´ç´šé è¨­ç‚ºç©º ---
const defaultRoster = `ä¸‰å¹´å¿ ç­,1,å‘‚å½¥æ¾„
ä¸‰å¹´å¿ ç­,2,è”¡é‡‘æ²³
ä¸‰å¹´å¿ ç­,3,è”¡æ²…ä½
ä¸‰å¹´å¿ ç­,4,åŠ‰å®‡æ˜•
ä¸‰å¹´å¿ ç­,5,ä¾¯ä½¾æ‰¿
ä¸‰å¹´å¿ ç­,6,è”¡æ‰¿ç¿°
ä¸‰å¹´å¿ ç­,7,é˜æŸå´´
ä¸‰å¹´å¿ ç­,8,è³´é‚µé‚¡
ä¸‰å¹´å¿ ç­,9,ä¾¯éˆç¨‹
ä¸‰å¹´å¿ ç­,10,æ—å»£æ›œ
ä¸‰å¹´å¿ ç­,11,è”¡å°‘ç‘‹
ä¸‰å¹´å¿ ç­,12,æ—æ­†å–¬
ä¸‰å¹´å¿ ç­,13,è³´æ˜ å„’
ä¸‰å¹´å¿ ç­,14,é™³èªæ—‹
ä¸‰å¹´å¿ ç­,15,é„­ç³ç¸ˆ
ä¸‰å¹´å¿ ç­,16,æ¥Šå©•å¦¤
ä¸‰å¹´å¿ ç­,17,æ¶‚å¨ ç‘„
ä¸‰å¹´å¿ ç­,18,æ–½å­ç‘œ
ä¸‰å¹´å¿ ç­,19,è˜‡ç›ˆç”„
ä¸‰å¹´å­ç­,1,è”¡æ—»å®‡
ä¸‰å¹´å­ç­,2,é™³ä½‘ä½‘
ä¸‰å¹´å­ç­,3,ä¾¯å‡±æ£®
ä¸‰å¹´å­ç­,4,å»–å† èµ«
ä¸‰å¹´å­ç­,5,å‘‚æ‰¿ç¿°
ä¸‰å¹´å­ç­,6,è”¡æ¿¬å¡
ä¸‰å¹´å­ç­,7,æ¥Šè«ºéœ–
ä¸‰å¹´å­ç­,8,é»ƒéº’å®
ä¸‰å¹´å­ç­,9,å®˜ç”«æ²…
ä¸‰å¹´å­ç­,10,é™³æ¤²æ·
ä¸‰å¹´å­ç­,11,è”¡ç§‰ç¶¸
ä¸‰å¹´å­ç­,12,å®˜èŠƒå¿»
ä¸‰å¹´å­ç­,13,è”¡è«å€«
ä¸‰å¹´å­ç­,14,å¾ä»¥ç’
ä¸‰å¹´å­ç­,15,è¨±å­Ÿç‘„
ä¸‰å¹´å­ç­,16,å®˜é›¨è±
ä¸‰å¹´å­ç­,17,ç‹é›¨å©•
ä¸‰å¹´ä»ç­,1,éƒ­ä¿¡è¾°
ä¸‰å¹´ä»ç­,2,æ²ˆå† éœ–
ä¸‰å¹´ä»ç­,3,çŸ³ç¿Šè¾°
ä¸‰å¹´ä»ç­,4,é»ƒå­å¥
ä¸‰å¹´ä»ç­,5,å‘‚æŸæ¨‚
ä¸‰å¹´ä»ç­,6,é»ƒå½¥ç¢©
ä¸‰å¹´ä»ç­,7,å‚…æ¤²æ©
ä¸‰å¹´ä»ç­,8,å³æ‰¿é‹™
ä¸‰å¹´ä»ç­,9,å³æ‰¿å‡
ä¸‰å¹´ä»ç­,10,å¼µæ–‡æ¬½
ä¸‰å¹´ä»ç­,11,çŸ³æ‰¿é‹
ä¸‰å¹´ä»ç­,12,åŠ‰å­å¯§
ä¸‰å¹´ä»ç­,13,é»ƒä¸€è‘¦
ä¸‰å¹´ä»ç­,14,é™³å€šé–
ä¸‰å¹´ä»ç­,15,è³´å®¶ç³›
ä¸‰å¹´ä»ç­,16,å‘‚å¦¤æ™¨
ä¸‰å¹´ä»ç­,17,ä¾¯å–¬é¦¨
ä¸‰å¹´ä»ç­,18,æ—å¦è“
ä¸‰å¹´ä»ç­,19,è¨±æ–‡è±
å››å¹´å¿ ç­,1,è”¡å®‡æš¢
å››å¹´å¿ ç­,2,å¼µå…æ°
å››å¹´å¿ ç­,3,æå´‡éŠ˜
å››å¹´å¿ ç­,4,è³´æ‰¿ç¿°
å››å¹´å¿ ç­,5,æ¢å…ç¿
å››å¹´å¿ ç­,6,æ¶‚å®¶éŠ˜
å››å¹´å¿ ç­,7,æŸ¯æ±¯ç
å››å¹´å¿ ç­,8,è”¡ä¾‘å®¸
å››å¹´å¿ ç­,9,æ—æ©ä¸
å››å¹´å¿ ç­,10,é¦¬ç¿Šæ„·
å››å¹´å¿ ç­,11,å¼µç­‘éˆ
å››å¹´å¿ ç­,12,é»ƒå­èŠ³
å››å¹´å¿ ç­,13,é™³èŠ“ä¼ƒ
å››å¹´å¿ ç­,14,é»ƒæ¦†åªƒ
å››å¹´å¿ ç­,15,å‚…ç´«æ™´
å››å¹´å¿ ç­,16,æ´ªåƒæ¶µ
å››å¹´å¿ ç­,17,é»ƒè‹¡è•
å››å¹´å¿ ç­,18,è”¡å®¹ç’‡
å››å¹´å¿ ç­,19,å¼µç´œç‘„
å››å¹´å¿ ç­,20,é„­æ©ä½³
å››å¹´å¿ ç­,21,è”¡æ¬£å®¸
å››å¹´å¿ ç­,22,è‘‰ç‘€ç‹
å››å¹´å­ç­,1,å‘‚å®¥ç¾©
å››å¹´å­ç­,2,æ—ç¾½ç¿”
å››å¹´å­ç­,3,é¦¬å‰ç‰
å››å¹´å­ç­,4,å¼µå®æº
å››å¹´å­ç­,5,è”¡æ”¿å¡
å››å¹´å­ç­,6,æç´˜èˆŸ
å››å¹´å­ç­,7,é»ƒæ³°é€¸
å››å¹´å­ç­,8,ä½•æŸè«’
å››å¹´å­ç­,9,é„­å…†å‡±
å››å¹´å­ç­,10,èŠå­è³¢
å››å¹´å­ç­,11,é›·ä¾å‹
å››å¹´å­ç­,12,ä¾¯èŠèŠ¸
å››å¹´å­ç­,13,ä¾¯æ—¨èŠ®
å››å¹´å­ç­,14,æ¶‚å¨ è’¨
å››å¹´å­ç­,15,è¨±åº­ç¶º
å››å¹´å­ç­,16,é¡è¾°èŠ³
å››å¹´å­ç­,17,é»ƒä½³æŸ”
å››å¹´å­ç­,18,æˆ´å¦æ˜•
å››å¹´å­ç­,19,ç¾…å­ä¾
å››å¹´å­ç­,20,è”¡å®œè¾°
å››å¹´ä»ç­,1,é™³æ›¸ç¨·
å››å¹´ä»ç­,2,é™³å•Ÿå³¯
å››å¹´ä»ç­,3,åŠ‰è€˜å…¸
å››å¹´ä»ç­,4,é™³äººè¯
å››å¹´ä»ç­,5,é„­äº¦æ©
å››å¹´ä»ç­,6,è¨±æ™¨æ©
å››å¹´ä»ç­,7,ç‹åšå½¥
å››å¹´ä»ç­,8,é¦¬å˜‰ä½‘
å››å¹´ä»ç­,9,é»ƒå¿ é™
å››å¹´ä»ç­,10,å³ç¥éŒ¦
å››å¹´ä»ç­,11,ç‹åˆåŠ 
å››å¹´ä»ç­,12,é™³æ¨‚
å››å¹´ä»ç­,13,å³èŠ¸æ©™
å››å¹´ä»ç­,14,å³èŠ¸è“
å››å¹´ä»ç­,15,æ—é‡‡æ¨‚
å››å¹´ä»ç­,16,å¼µæ˜±è‡»
å››å¹´ä»ç­,17,å¼µäº‘é¦¨
å››å¹´ä»ç­,18,è”¡èªå–¬
å››å¹´ä»ç­,19,æ´ªè‹¥çˆ
å››å¹´ä»ç­,20,å®˜éœˆæ²„
å››å¹´ä»ç­,21,ä¾¯æ€¡ç
å››å¹´ä»ç­,22,ç‹ä»²å‰
äº”å¹´å¿ ç­,1,æ¥Šä»æ°
äº”å¹´å¿ ç­,2,éƒ­å† å»·
äº”å¹´å¿ ç­,3,é™³å’Œé€¸
äº”å¹´å¿ ç­,4,å³å¥•æ³°
äº”å¹´å¿ ç­,5,ç‹èŒ‚ç•¯
äº”å¹´å¿ ç­,6,æ¸©å®‡åŸ
äº”å¹´å¿ ç­,7,æ—ç¨æ·
äº”å¹´å¿ ç­,8,å‚…äºè»’
äº”å¹´å¿ ç­,9,é™³å…ƒéº’
äº”å¹´å¿ ç­,10,é¦¬ç›ˆå®‰
äº”å¹´å¿ ç­,11,å‘‚æ˜€ç”„
äº”å¹´å¿ ç­,12,æå¦è³ª
äº”å¹´å¿ ç­,13,æ—èŠ¯ç¾½
äº”å¹´å¿ ç­,14,æ²ˆåº­å¦¤
äº”å¹´å¿ ç­,15,è”¡å­£åº­
äº”å¹´å¿ ç­,16,æ²ˆèŠå„€
äº”å¹´å¿ ç­,17,é¦¬è‹¹ç
äº”å¹´å¿ ç­,18,å¼µèŠ¯æ…ˆ
äº”å¹´å¿ ç­,19,å³è‹¡è“
äº”å¹´å­ç­,1,å‘‚èµ·æ­
äº”å¹´å­ç­,2,ä¾¯å®‡å®¸
äº”å¹´å­ç­,3,è˜‡å½¥å®¸
äº”å¹´å­ç­,4,æè‚²å³°
äº”å¹´å­ç­,5,ä¾¯å¨ä¸
äº”å¹´å­ç­,6,ææ˜å„’
äº”å¹´å­ç­,7,å¾æŸæ¦†
äº”å¹´å­ç­,8,è³´è­½ä»
äº”å¹´å­ç­,9,æ—å½¥ä½‘
äº”å¹´å­ç­,10,è¨±èŠ¯å«™
äº”å¹´å­ç­,11,é»ƒå­æ©
äº”å¹´å­ç­,12,å³ç·¯ç³
äº”å¹´å­ç­,13,é»ƒå­å®¸
äº”å¹´å­ç­,14,è”¡æ¥¹å§
äº”å¹´å­ç­,15,é›·å°è‘†
äº”å¹´å­ç­,16,æè¾°æ™
äº”å¹´å­ç­,17,é™³å€šå¸†
äº”å¹´å­ç­,18,é™³ä¾å§
äº”å¹´ä»ç­,1,ç‹å¥å€«
äº”å¹´ä»ç­,2,é»ƒå† æ£ 
äº”å¹´ä»ç­,3,éŒ¢å®£é‚‘
äº”å¹´ä»ç­,4,éƒ­å‘å®¸
äº”å¹´ä»ç­,5,é»ƒå† éœ–
äº”å¹´ä»ç­,6,é¾”é€¸å‡±
äº”å¹´ä»ç­,7,è”¡å°‘æœ‹
äº”å¹´ä»ç­,8,å‘‚æ±æ¾¤
äº”å¹´ä»ç­,9,è³´ä¿Šç‘‹
äº”å¹´ä»ç­,10,å‘‚å¿»å€ª
äº”å¹´ä»ç­,11,é™³å®¥è‡»
äº”å¹´ä»ç­,12,åŠ‰èŠ¯æ²…
äº”å¹´ä»ç­,13,è”¡äº‘é¦¨
äº”å¹´ä»ç­,14,ç¿è‹¥äº‘
äº”å¹´ä»ç­,15,é™³å·§èŠ³
äº”å¹´ä»ç­,16,è•­æ¢“å–¬
äº”å¹´ä»ç­,17,å‘‚å–¬åª—
äº”å¹´ä»ç­,18,æ—è‹¡èŒœ
å…­å¹´å¿ ç­,1,è”¡å²³åº­
å…­å¹´å¿ ç­,2,é»ƒçšç¥
å…­å¹´å¿ ç­,3,é™³æŸè±ª
å…­å¹´å¿ ç­,4,å³å¥•éœ‡
å…­å¹´å¿ ç­,5,è‘‰ä¸ç¥
å…­å¹´å¿ ç­,6,é™³å»ºç¶¸
å…­å¹´å¿ ç­,7,é»ƒå‚³è–ª
å…­å¹´å¿ ç­,8,è”¡å˜‰é¾
å…­å¹´å¿ ç­,9,ç‹ç‘€æ¾¤
å…­å¹´å¿ ç­,10,é¦¬ä¼¯å‹³
å…­å¹´å¿ ç­,11,é™³éŸ‹å‘ˆ
å…­å¹´å¿ ç­,12,å‘å”„æ¨‚
å…­å¹´å¿ ç­,13,å³æ˜€éœ
å…­å¹´å¿ ç­,14,è”¡é›¨æ©
å…­å¹´å¿ ç­,15,é­ç¶¾åœ»
å…­å¹´å¿ ç­,16,å®˜å®œè“
å…­å¹´å¿ ç­,17,é„­ç«¹æ™½
å…­å¹´å¿ ç­,18,å¼µèŠŠéˆº
å…­å¹´å¿ ç­,19,é»ƒæ¢“æ¦•
å…­å¹´å¿ ç­,20,æä¾å®¸
å…­å¹´å¿ ç­,21,ç‹è‹¡æ©
å…­å¹´å¿ ç­,22,è”¡å®›è“
å…­å¹´å¿ ç­,23,å¼µèŠƒç·—
å…­å¹´å­ç­,1,é™³æŸç¶­
å…­å¹´å­ç­,2,æ—å† å»·
å…­å¹´å­ç­,3,é›·æŒ¯å®‡
å…­å¹´å­ç­,4,è”¡æ‰¿è«­
å…­å¹´å­ç­,5,å‘‚å¨éœ†
å…­å¹´å­ç­,6,ç›§å½¥ç’‹
å…­å¹´å­ç­,7,å¼µèª æ©
å…­å¹´å­ç­,8,è˜‡éƒæ™º
å…­å¹´å­ç­,9,å®˜è‡¨æ©
å…­å¹´å­ç­,10,ä½•æ¢“ä¼Š
å…­å¹´å­ç­,11,é¦¬ç¿Šç‘
å…­å¹´å­ç­,12,å®˜é‡‡æŸ”
å…­å¹´å­ç­,13,é™³éŸ‹èŒ¹
å…­å¹´å­ç­,14,é™³æ©å˜‰
å…­å¹´å­ç­,15,å‘‚å¿»è«­
å…­å¹´å­ç­,16,å»–æ–‡å¦¤
å…­å¹´å­ç­,17,æ–½å¿»å¦¤
å…­å¹´å­ç­,18,æé‡‡è¡£
å…­å¹´å­ç­,19,åŠ‰å®œå©·
å…­å¹´å­ç­,20,é˜äº­æ±¶
å…­å¹´å­ç­,21,é»ƒæ²›èŠ¯
å…­å¹´å­ç­,22,è”¡ä¾å¡
å…­å¹´å­ç­,23,ç‹å¦¡ä¼ƒ
å…­å¹´ä»ç­,1,æ¥Šæ‰¿è«º
å…­å¹´ä»ç­,2,ææ˜Œéœ–
å…­å¹´ä»ç­,3,ç‹ä»²å®‡
å…­å¹´ä»ç­,4,å¼µå®¸ç‘‹
å…­å¹´ä»ç­,5,é™³å®¥å»·
å…­å¹´ä»ç­,6,å¼µæ©æ‰¿
å…­å¹´ä»ç­,7,è˜‡è£•èƒ
å…­å¹´ä»ç­,8,ä¾¯æŸè¾°
å…­å¹´ä»ç­,9,è”¡æ˜å“²
å…­å¹´ä»ç­,10,æ—å£«æ¶µ
å…­å¹´ä»ç­,11,ç‹æ™¨è¦Ÿ
å…­å¹´ä»ç­,12,é™³å¦ç”¯
å…­å¹´ä»ç­,13,è¨±èŠ·ç‘„
å…­å¹´ä»ç­,14,è¨±å½©èŠ¯
å…­å¹´ä»ç­,15,å¼µç‰ç‘„
å…­å¹´ä»ç­,16,æ—ç¬é ¤
å…­å¹´ä»ç­,17,é™³æ¯“æ½”
å…­å¹´ä»ç­,18,è”¡å®œç‡
å…­å¹´ä»ç­,19,å®˜å¯é¦¨
å…­å¹´ä»ç­,20,è”¡ä½³è«¼
å…­å¹´ä»ç­,21,é»ƒç¬ç‡
å…­å¹´ä»ç­,22,è•­æ•å®‰
å…­å¹´ä»ç­,23,é»ƒç®å©·`;

// --- ç‹€æ…‹èˆ‡å·¥å…· ---
const state={classes:{}, drawn:{}};
function parseRoster(text){
  const data={};
  const lines=text.split(/\n+/).map(s=>s.trim()).filter(Boolean);
  for(const line of lines){
    const parts=line.split(/,|\t|\s+/).map(s=>s.trim()).filter(Boolean);
    if(parts.length<3) continue;
    const [klass, seatStr, ...nameParts]=parts;
    const seat=Number(seatStr.replace(/[^0-9]/g,''))||'';
    const name=nameParts.join('');
    if(!data[klass]) data[klass]=[];
    data[klass].push({seat,name});
  }
  for(const k in data) data[k].sort((a,b)=>(a.seat||0)-(b.seat||0));
  return data;
}

function pickCandidate(arr, drawnList){
  const candidates=arr.filter(s=>!drawnList.includes(s.name));
  if(candidates.length===0) return null;
  return candidates[Math.floor(Math.random()*candidates.length)];
}

// --- å‹•ç•« ---
function animateDraw(klass, box, done){
  const arr=state.classes[klass]||[];
  if(arr.length===0) { box.textContent=klass+'ï¼šç„¡åå–®'; return; }
  if(!state.drawn[klass]) state.drawn[klass]=[];

  let finalStu = pickCandidate(arr, state.drawn[klass]);
  if(!finalStu) { state.drawn[klass]=[]; finalStu = pickCandidate(arr, state.drawn[klass]); }
  state.drawn[klass].push(finalStu.name);

  let i=0, ticks=0;
  const total = Math.max(arr.length, Math.floor(arr.length*1.2));
  const it = setInterval(()=>{
    box.textContent = `${klass}: ${arr[i%arr.length].name}`;
    if(ticks%2===0) playTick();
    i++; ticks++;
    if(ticks>total) {
      clearInterval(it);
      setTimeout(()=>{
        box.textContent=`${klass}: ${finalStu.name}`;
        box.classList.remove('highlight'); void box.offsetWidth; box.classList.add('highlight');
        playDing();
        done && done(finalStu);
      }, 60);
    }
  }, 80);
}

function drawForGrade(grade){
  const classes = Object.keys(state.classes).filter(k=>k.startsWith(grade));
  const container=document.getElementById('animationArea');
  container.innerHTML='';
  const results=[];
  classes.forEach(c=>{
    const div=document.createElement('div');
    div.className='classBox';
    div.textContent=c;
    container.appendChild(div);
    animateDraw(c,div,(stu)=>{
      results.push({klass:c, seat:stu.seat, name:stu.name});
      if(results.length===classes.length) renderFinal(results);
    });
  });
}

function redrawSingle(klass){
  const boxes=[...document.querySelectorAll('.classBox')];
  const box=boxes.find(b=>b.textContent.startsWith(klass)) || null;
  if(!box) return;
  animateDraw(klass, box, (stu)=>{
    const table=document.querySelector('#finalResult table');
    if(table){
      [...table.querySelectorAll('tbody tr')].forEach(r=>{
        if(r.cells[0].textContent===klass){
          r.cells[1].textContent = stu.seat;
          r.cells[2].textContent = stu.name;
        }
      });
    }
  });
}

function renderFinal(results){
  results.sort((a,b)=>a.klass.localeCompare(b.klass,'zh-Hant'));
  const div=document.getElementById('finalResult');
  let html='<h3>ğŸ‰ æœ€çµ‚çµæœ</h3>';
  html+='<table><thead><tr><th>ç­ç´š</th><th>åº§è™Ÿ</th><th>å§“å</th><th>æ“ä½œ</th></tr></thead><tbody>';
  results.forEach(r=>{ html+=`<tr><td>${r.klass}</td><td>${r.seat}</td><td>${r.name}</td><td><button class="btn-small" onclick="redrawSingle('${r.klass}')">ğŸ” é‡æŠ½</button></td></tr>`; });
  html+='</tbody></table>';
  div.innerHTML=html;
}

// --- åŒ¯å…¥èˆ‡åˆå§‹åŒ– ---
document.getElementById('btnParse').addEventListener('click',()=>{
  const text=document.getElementById('roster').value.trim();
  if(!text) return alert('è«‹å…ˆæŠŠåå–®è²¼åˆ°æ–‡å­—æ¡†ï¼Œå†æŒ‰ã€Œé‡æ–°åŒ¯å…¥åå–®ã€ã€‚');
  state.classes=parseRoster(text);
  state.drawn={};
  alert('åå–®å·²åŒ¯å…¥ï¼');
});
document.getElementById('btnDraw').addEventListener('click',()=>{
  document.querySelectorAll('.classBox').forEach(n=>n.classList.remove('highlight'));
  const grade=document.getElementById('gradeSelect').value;
  drawForGrade(grade);
});

// é è¨­è¼‰å…¥å…§å»ºåå–®
document.getElementById('roster').value = defaultRoster;
state.classes = parseRoster(defaultRoster);
</script>
</body>
</html>
